- hosts: "{{ hosts| default('all') }}"
  become: yes
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  pre_tasks:
    - name: Python predependency
      raw: bash -c "test -e /usr/bin/python3" || (sudo apt update && sudo apt install -y  python3)
    - name: Installing other packages
      apt:
        state: present
        name: ['python-pkg-resources', 'python2-pip']
      when: ansible_distribution_version | float < 18
    - name: Installing other packages
      apt:
        state: present
        name: ['python3-pip', 'python-pkg-resources', 'acl']
      when: ansible_distribution_version | float > 18
  roles:
    - bootstrap_any
  tags:
    - bootstrap_any
    - all

- hosts: "{{hosts}}"
  gather_facts: no
  become: yes
  ignore_unreachable: yes
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  roles:
    - role: azure-cli
  tags:
    - azure_cli

- hosts: "{{ hosts| default('all') }}"
  become: yes
  gather_facts: no
  ignore_unreachable: yes
  vars_files:
    - "{{inventory_dir}}/secrets.yml"
  roles:
    - vm-agents-nodeexporter
  tags:
    - node_exporter
    - all
